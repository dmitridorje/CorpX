# Account Service

## Описание

Этот микросервис предоставляет функционал для управления балансами пользователей, проведения платежных операций, работы с накопительными счетами, а также реализует аудит финансовых операций и управление кэшбеком.

## Основные возможности

1. Управление балансами:
   - Создание, обновление и блокировка балансов.
   - Аудит финансовых операций с хранением истории изменений.

2. Платежные операции:
   - Инициация, отмена и подтверждение платежей.
   - Поддержка двухэтапных операций: авторизация и клиринг.
   - Реализация идемпотентности операций.

3. Накопительные счета:
   - Управление накопительными счетами и тарифами.
   - Подсчет процентов и их начисление.
   - Интеграция с другими сервисами для настройки ставок.

4. Кэшбек:
   - Настройка тарифов для операций и продавцов.
   - Автоматическое начисление кэшбека.

5. Управление номерами счетов:
   - Генерация и назначение уникальных номеров.
   - Реализация через оптимистическую блокировку.

6. Нотификации:
   - Уведомления пользователей о событиях, связанных с их балансами и счетами.

## Технические детали

### Балансы
- **Основные параметры**:
  - Номер счета.
  - Авторизационный и фактический баланс.
  - Версия для реализации оптимистической блокировки.
- **Аудит балансов**:
  - История изменений с версионностью.
  - Хранение данных в таблице `balance_audit`.

### Накопительные счета
- **Особенности**:
  - Хранение историй ставок и тарифов.
  - Начисление процентов с учетом активности пользователей.
  - Интеграция с сервисами достижений и уведомлений.

### Платежные операции
- **Двухэтапная структура**:
  - Авторизация — временная блокировка средств.
  - Клиринг — фактическое списание средств.
- **Обработка ошибок**:
  - Отмена операций при сбоях.

### Номера счетов
- **Генерация номеров**:
  - Предварительная генерация уникальных номеров.
  - Реализация через таблицы `free_account_numbers` и `account_numbers_sequence`.

### Кэшбек
- **Гибкие настройки**:
  - Маппинг операций и продавцов на тарифы.
  - Ежемесячное начисление кэшбека через `@Scheduled` задачи.
